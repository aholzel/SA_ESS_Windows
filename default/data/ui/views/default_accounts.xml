<form script="default_accounts.js">
  <label>Default Account Activity</label>
  <fieldset autoRun="true" submitButton="true">
    <input type="text" token="bunit_form">
      <label>Business Unit</label>
      <default></default>
    </input>
    <input type="dropdown" token="category_form">
      <label>Category</label>
      <choice value="">All</choice>
      <populatingSearch fieldForValue="category" fieldForLabel="category">| `categories`</populatingSearch>
      <default></default>
    </input>
    <input type="time">
      <default>Last 24 hours</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <title># Admin password change</title>
        <search>
          <query>`winevent_security` (EventCode=4723 OR EventCode=4724 OR EventCode=627) [inputlookup administrative_identities.csv | fields identity | rename identity as user]| stats count as adminPasswordChange | rangemap field=adminPasswordChange low=0-0 severe=1-1000 default=low</query>
        </search>
        <drilldown>
          <link>
            <![CDATA[
				     /app/SplunkEnterpriseSecuritySuite/admin_password_changes
					]]>
          </link>
        </drilldown>
        <option name="drilldown">all</option>
        <option name="linkView">search</option>
      </single>
    </panel>
    <panel>
      <single>
        <title># Default accounts in use</title>
        <search>
          <query>| tstats summariesonly=t max(_time) as _time,values(Authentication.user_category) as user_category,dc(Authentication.dest) as dc(dest) from datamodel=Authentication where Authentication.user_category=default   by Authentication.user | stats count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="linkView">search</option>
      </single>
    </panel>
    <panel>
      <single>
        <title># Interactive service account logons</title>
        <search>
          <query>| tstats summariesonly=t max(_time) as _time,values(Authentication.user_category) as user_category,dc(Authentication.dest) as dc(dest),values(Authentication.tag) as tag, from datamodel=Authentication where Authentication.user_category=interactive_no AND Authentication.tag=login_interactive by Authentication.user | stats count</query>
        </search>
        <drilldown>
          <link>
            <![CDATA[
				     /app/SplunkEnterpriseSecuritySuite/interactive_serviceaccount_logon
					]]>
          </link>
        </drilldown>
        <option name="drilldown">all</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <chart id="element1">
        <title>Default Account Usage Over Time By App</title>
        <searchTemplate>| tstats summariesonly=t count from datamodel=Authentication where nodename=Authentication.Default_Authentication Authentication.action=success $dm_bunit$ $dm_category$ by _time,Authentication.app span=1h | timechart minspan=1h count by Authentication.app | `drop_dm_object_name("Authentication")`</searchTemplate>
        <option name="charting.axisTitleX.text">time</option>
        <option name="charting.axisTitleY.text">count</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <drilldown>
          <link>search?q=| `datamodel("Authentication", "Default_Authentication")` | `drop_dm_object_name("Authentication")` | search app="$click.name2$"&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table id="element2">
        <title>Default Accounts In Use</title>
        <searchTemplate>| tstats summariesonly=t max(_time) as _time,values(Authentication.user_category) as user_category,dc(Authentication.dest) as dc(dest) from datamodel=Authentication where Authentication.user_category=default $dm_bunit$ $dm_category$ by Authentication.user | `drop_dm_object_name("Authentication")` | sort 100 - _time | fields _time,user,user_category,dc(dest)</searchTemplate>
        <drilldown>
          <link>access_search?form.user=$row.user$&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <table id="element4">
        <title>Interactive Service account login</title>
        <searchTemplate>| tstats summariesonly=t max(_time) as _time,values(Authentication.user_category) as user_category,dc(Authentication.dest) as dc(dest),values(Authentication.tag) as tag, from datamodel=Authentication where Authentication.user_category=interactive_no AND Authentication.tag=login_interactive by Authentication.user |`drop_dm_object_name("Authentication")` | sort 100 - _time | fields _time,user,user_category,dc(dest)</searchTemplate>
        <drilldown>
          <link>access_search?form.user=$row.user$&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <table id="element3">
        <title>Default Local Accounts</title>
        <searchTemplate>| `useraccounts_tracker` | search user_category=default $bunit$ $category$ | stats max(lastTime) as _time,values(user_category) as user_category,dc(dest) as dc(dest) by user | sort 100 - _time | fields _time,user,user_category,dc(dest)</searchTemplate>
        <drilldown>
          <link>search?q=| `datamodel("Compute_Inventory", "User")` | `drop_dm_object_name("All_Inventory")` | `drop_dm_object_name("User")` | search user="$row.user$"&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>